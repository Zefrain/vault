# Vault 改造说明

## 安全改造说明

- 目的：使官方 vault 不能获取 pim 数据
- 方法：使用 sm4 加密

### 改造详情

| 文件                     | 函数或变量       | 目的                                                         |
| ------------------------ | ---------------- | ------------------------------------------------------------ |
| vault/barrier_aes_gcm.go | `encrypt`        | 加密函数，在函数中，当使用sm4加密时，加密数据中保存了key信息 |
|                          | `decrypt`        | 解密函数                                                     |
|                          | `rootKey []byte` | 在初始化keyring时使sm4能获取可用key(rootkey)                 |
|                          | `sm4keyFromTerm` | 新增函数：使加密时可以根据 term 获取 key                     |
| command/server/config.go | `EncryptMethod`  | 新增配置项 `encrypt_method`，决定初始化时的加密方法，取值：<br />sm4/aes_gcm_v1/aes_gcm_v2 |
|                          | `ParseConfig`    | 新增配置项的解析                                             |

